language: go
sudo: false

go:
  - 1.x

before_install:
  - go get github.com/mitchellh/gox

install:
  -  # skip

script:
  - go get -t -v
  - gox -os="linux darwin windows" -arch="amd64" -verbose
  - gox -os="linux darwin windows" -arch="386" -verbose

before_deploy:
  - git config --local user.name $GITHUB_USER
  - git config --local user.email $GITHUB_EMAIL
  - export TRAVIS_TAG=${TRAVIS_TAG:-$(date +'%Y%m%d%H%M%S')-$(git log --format=%h -1)}
  - git tag $TRAVIS_TAG

deploy:
  provider: releases
  api_key: $GITHUB_OAUTH_TOKEN
  file_glob: true
  file:
    - "httplive_*"
  skip_cleanup: true
